<ROSETTASCRIPTS>

  <SCOREFXNS>
    <ScoreFunction name="fullatom" weights="talaris2014" />
  </SCOREFXNS>

  <RESIDUE_SELECTORS>
    # Template: 3lhp.pdb.gz: Engineered protein.
    <Index name="insertion"       resnums="49S-70S" />
    <Chain name="template_chain"  chains="S" />
    <Index name="template_alphas" resnums="8S-39S,45S-81S,88S-121S" />
    <Index name="template_local"  resnums="16S-37S,49S-70S,101S-120S" />

    # Motif: pdbs/4oyd.pdb.gz: COMPUTATIONALLY DESIGNED INHIBITOR
    <Index name="query_motif"   resnums="43B-64B" />
    <Index name="target_chain"  resnums="1B-116B" />
    <Index name="target_alphas" resnums="2B-33B,39B-75B,82B-115B" />
    <Index name="target_local"  resnums="10B-31B,43B-64B,95B-114B" />

  </RESIDUE_SELECTORS>

  <FILTERS> # (confidence=0 -> to score not to filter)
    # Check global (all) RMSD
    <RmsdFromResidueSelectorFilter name="GlobalRMSD" reference_name="template_pose"
      reference_selector="target_chain" query_selector="template_chain" confidence="1" />

    # Local (all) RMSD
    <RmsdFromResidueSelectorFilter name="LocalRMSD" reference_name="template_pose" superimpose="false"
       reference_selector="target_chain" query_selector="template_chain" confidence="1" />
    
    # Local (alpha) RMSD
    <RmsdFromResidueSelectorFilter name="LocalRMSDH" reference_name="template_pose" superimpose="false"
       reference_selector="target_alphas" query_selector="template_alphas" confidence="1" />

    # Local (local) RMSD
    <RmsdFromResidueSelectorFilter name="LocalRMSDL" reference_name="template_pose" superimpose="false"
       reference_selector="target_local" query_selector="template_local" confidence="1" />

  </FILTERS>

  <MOVERS>
    # The "template" is the one pose from the assemble that we are not piping as input
    <SavePoseMover name="load_template" reference_name="template_pose" pdb_file="../../pdbs/4oyd.pdb.gz" />

    # Local Alignment for RMSD
    <AlignByResidueSelectorMover name="align" reference_name="template_pose"
      reference_selector="query_motif" query_selector="insertion" />

  </MOVERS>

  <PROTOCOLS>
    # Global First
    <Add filter="GlobalRMSD" />
    # Loop align-eval
    <Add mover="align" />
    <Add filter="LocalRMSD" />
    <Add filter="LocalRMSDH" />
    <Add filter="LocalRMSDL" />
  </PROTOCOLS>
</ROSETTASCRIPTS>
